import { useMemo, useState, useEffect } from 'react'

type Locale = 'en' | 'ko'

const dictionary = {
  en: {
    appTagline: 'Trading Journal',
    navHome: 'Home',
    navPortfolio: 'Portfolio',
    navChart: 'Chart',
    navAlert: 'Alert',
    navBubbles: 'Bubbles',
    navTrades: 'Trades',
    navReview: 'Review',
    navSettings: 'Settings',
    sessionLabel: 'Session',
    sessionText: 'You are authenticated.',
    logout: 'Log out',
    loginTitle: 'Login',
    loginSubtitle: 'Use your registered email and password.',
    registerTitle: 'Create account',
    registerSubtitle: 'Start with a free tier account.',
    loginHeadline: 'Welcome back to your trading journal.',
    loginBody: 'Review previous decisions, request AI commentary, and keep your execution loop tight.',
    registerHeadline: 'Build your execution memory.',
    registerBody: 'Track setups, annotate entries, and compare outcome feedback across time.',
    betaReminderTitle: 'Beta reminder',
    betaReminderBody: 'AI opinions are tracked against your outcome metrics. Keep notes precise for the best review.',
    starterPerksTitle: 'Starter perks',
    loginButton: 'Login',
    registerButton: 'Create account',
    emailLabel: 'Email',
    passwordLabel: 'Password',
    nameLabel: 'Name',
    loginLinkText: 'Login',
    registerLinkText: 'Create an account',
    loginFooter: 'New here?',
    registerFooter: 'Already have an account?',
    chartTitle: 'Chart Overview',
    chartSubtitle: 'Track live candles and create bubbles directly on the chart.',
    symbolSearchLabel: 'Search',
    symbolSearchPlaceholder: 'Search symbols (BTCUSDT)',
    symbolSearchLoading: 'Searching...',
    symbolSearchEmpty: 'No matching symbols',
    symbolSearchFailed: 'Failed to search symbols.',
    symbolLabel: 'Symbol',
    timeframeLabel: 'Timeframe',
    rangeLabel: 'Range',
    range6m: '6M',
    range1y: '1Y',
    loading: 'Loading...',
    noData: 'No data yet.',
    refresh: 'Refresh',
    requestAi: 'Request AI',
    bubbleDetails: 'Bubble details',
    memoLabel: 'Memo',
    attachmentsLabel: 'Attachments',
    saving: 'Saving...',
    actionsLabel: 'Actions',
    createBubble: 'Create Bubble',
    statusLabel: 'Status',
    statusLoading: 'Loading candles...',
    statusReady: 'Live view ready',
    bubbleFlowLabel: 'Bubble Flow',
    bubbleFlowText: 'Click a candle to create a bubble.',
    aiInsightsLabel: 'AI Insights',
    aiReady: 'Ready',
    aiReadyText: 'AI commentary will appear on demand.',
    bubblesTitle: 'Bubble Library',
    bubblesSubtitle: 'Compare tagged setups, AI commentary, and outcomes in one place.',
    recentBubbles: 'Recent bubbles',
    tradesTitle: 'Trade Intelligence',
    tradesSubtitle: 'Review executed trades, realized PnL, and symbol patterns.',
    tradesLoadFailed: 'Failed to load trade history.',
    importCsv: 'Import CSV',
    importing: 'Importing...',
    importHint: 'CSV: exchange,symbol,side,quantity,price,realized_pnl,trade_time',
    importSuccess: 'Imported',
    importFailed: 'Failed to import CSV.',
    pnlDistributionTitle: 'PnL distribution',
    pnlDistributionHint: 'Realized PnL buckets',
    pnlDistributionEmpty: 'No realized PnL data yet.',
    exchangeLabel: 'Exchange',
    fromLabel: 'From',
    toLabel: 'To',
    totalTrades: 'Total trades',
    tradesWindowHint: 'Filter by exchange or time range.',
    netPnL: 'Net PnL',
    realizedPnL: 'Realized PnL',
    winRate: 'Win rate',
    breakEven: 'Breakeven',
    breakEvenHint: '0 PnL trades',
    tradeHistory: 'Trade history',
    recentTrades: 'Recent trades',
    quantityLabel: 'Qty',
    byExchange: 'By exchange',
    bySide: 'By side',
    bySymbol: 'By symbol',
    aiOpinions: 'AI opinions',
    outcomes: 'Outcome recap',
    similarSetups: 'Similar setups',
    outcomeTitle: 'Outcome tracking',
    similarTitle: 'Similar setups',
    settingsTitle: 'Settings',
    settingsSubtitle: 'Manage exchanges, AI keys, and subscription preferences.',
    notFoundTitle: 'This route does not exist.',
    notFoundBody: 'The page you are looking for is not part of the current workspace. Return to the chart view.',
    goToChart: 'Go to chart',
    bubbleModalTitle: 'New bubble log',
    bubbleModalSubtitle: 'Record your context before the moment fades.',
    bubbleSideLabel: 'Side',
    bubbleSideNeutral: 'Neutral',
    bubbleSideBuy: 'Buy',
    bubbleSideSell: 'Sell',
    candleTimeLabel: 'Candle Time',
    priceLabel: 'Price',
    memoLabel: 'Memo',
    tagsLabel: 'Tags (comma separated)',
    cancel: 'Cancel',
    saveBubble: 'Save bubble',
    // Alerts & Notifications
    navAlerts: 'Alerts',
    alertsTitle: 'Alerts',
    alertsSubtitle: 'Monitor triggered alerts and record your decisions.',
    alertRulesTitle: 'Alert Rules',
    alertRulesSubtitle: 'Configure conditions to trigger alerts.',
    alertDetailTitle: 'Alert Detail',
    noAlerts: 'No alerts yet.',
    noRules: 'No rules configured.',
    createRule: 'Create Rule',
    editRule: 'Edit Rule',
    deleteRule: 'Delete',
    ruleName: 'Rule Name',
    ruleType: 'Rule Type',
    ruleSymbol: 'Symbol',
    ruleEnabled: 'Enabled',
    ruleCooldown: 'Cooldown (min)',
    ruleTypePrice: 'Price Change',
    ruleTypeMA: 'MA Cross',
    ruleTypeLevel: 'Price Level',
    ruleTypeVolatility: 'Volatility Spike',
    statusAll: 'All',
    statusPending: 'Pending',
    statusBriefed: 'Briefed',
    statusDecided: 'Decided',
    statusExpired: 'Expired',
    severityNormal: 'Normal',
    severityUrgent: 'Urgent',
    aiBriefings: 'AI Briefings',
    noBriefings: 'No AI briefings yet.',
    decisionTitle: 'Your Decision',
    decisionAction: 'Action',
    decisionMemo: 'Memo',
    decisionConfidence: 'Confidence',
    submitDecision: 'Submit Decision',
    dismissAlert: 'Dismiss',
    outcomeTitle: 'Outcomes',
    noOutcomes: 'Outcome data not yet calculated.',
    confidenceHigh: 'High',
    confidenceMedium: 'Medium',
    confidenceLow: 'Low',
    actionBuy: 'Buy',
    actionSell: 'Sell',
    actionHold: 'Hold',
    actionClose: 'Close',
    actionReduce: 'Reduce',
    actionAdd: 'Add',
    actionIgnore: 'Ignore',
    telegramTitle: 'Telegram Notifications',
    telegramConnect: 'Connect Telegram',
    telegramDisconnect: 'Disconnect',
    telegramConnected: 'Connected',
    telegramNotConnected: 'Not connected',
    telegramCodeMsg: 'Send this code to our Telegram Bot:',
    telegramOpenBot: 'Click the button below to connect via Telegram:',
    telegramOpenBotBtn: 'Open in Telegram',
    telegramExpires: 'Expires in',
    direction: 'Direction',
    threshold: 'Threshold',
    reference: 'Reference',
    maPeriod: 'MA Period',
    maTimeframe: 'Timeframe',
    targetPrice: 'Target Price',
    multiplier: 'Multiplier',
    timeAgo: 'ago',
    viewDetail: 'View',
    manageRules: 'Manage Rules',
    save: 'Save',
  },
  ko: {
    appTagline: 'Trading Journal',
    navHome: '홈',
    navPortfolio: '포트폴리오',
    navChart: '차트',
    navAlert: '긴급',
    navBubbles: '버블',
    navTrades: '거래',
    navReview: '복기',
    navSettings: '설정',
    sessionLabel: '세션',
    sessionText: '로그인 상태입니다.',
    logout: '로그아웃',
    loginTitle: '로그인',
    loginSubtitle: '등록한 이메일과 비밀번호를 사용하세요.',
    registerTitle: '계정 만들기',
    registerSubtitle: '무료 플랜으로 시작할 수 있습니다.',
    loginHeadline: '트레이딩 저널로 돌아오셨네요.',
    loginBody: '과거 판단을 복기하고 AI 코멘트를 받아보세요.',
    registerHeadline: '실행 기록을 쌓아보세요.',
    registerBody: '셋업과 메모를 남기고 결과 피드백을 비교할 수 있습니다.',
    betaReminderTitle: '베타 안내',
    betaReminderBody: 'AI 의견은 결과 지표와 함께 기록됩니다. 메모를 구체적으로 남겨보세요.',
    starterPerksTitle: '스타터 혜택',
    loginButton: '로그인',
    registerButton: '계정 만들기',
    emailLabel: '이메일',
    passwordLabel: '비밀번호',
    nameLabel: '이름',
    loginLinkText: '로그인',
    registerLinkText: '회원가입',
    loginFooter: '처음이신가요?',
    registerFooter: '이미 계정이 있나요?',
    chartTitle: '차트 개요',
    chartSubtitle: '실시간 캔들을 확인하고 바로 버블을 생성하세요.',
    symbolSearchLabel: '검색',
    symbolSearchPlaceholder: '심볼 검색 (BTCUSDT)',
    symbolSearchLoading: '검색 중...',
    symbolSearchEmpty: '검색 결과가 없습니다.',
    symbolSearchFailed: '심볼 검색에 실패했습니다.',
    symbolLabel: '심볼',
    timeframeLabel: '타임프레임',
    rangeLabel: '기간',
    range6m: '6개월',
    range1y: '1년',
    loading: '불러오는 중...',
    noData: '아직 데이터가 없습니다.',
    refresh: '새로고침',
    requestAi: 'AI 요청',
    bubbleDetails: '버블 상세',
    memoLabel: '메모',
    attachmentsLabel: '첨부',
    saving: '저장 중...',
    actionsLabel: '동작',
    createBubble: '버블 생성',
    statusLabel: '상태',
    statusLoading: '캔들 불러오는 중...',
    statusReady: '라이브 준비됨',
    bubbleFlowLabel: '버블 플로우',
    bubbleFlowText: '캔들을 클릭해 버블을 생성하세요.',
    aiInsightsLabel: 'AI 인사이트',
    aiReady: '준비됨',
    aiReadyText: '원할 때 AI 코멘트를 확인할 수 있습니다.',
    bubblesTitle: '버블 라이브러리',
    bubblesSubtitle: '태그와 AI 의견, 결과를 한곳에서 비교합니다.',
    recentBubbles: '최근 버블',
    tradesTitle: '거래 인사이트',
    tradesSubtitle: '체결 내역과 실현 손익, 종목 패턴을 확인하세요.',
    tradesLoadFailed: '거래 내역을 불러오지 못했습니다.',
    importCsv: 'CSV 가져오기',
    importing: '가져오는 중...',
    importHint: 'CSV: exchange,symbol,side,quantity,price,realized_pnl,trade_time',
    importSuccess: '가져오기 완료',
    importFailed: 'CSV 가져오기에 실패했습니다.',
    pnlDistributionTitle: '손익 분포',
    pnlDistributionHint: '실현 손익 구간',
    pnlDistributionEmpty: '실현 손익 데이터가 없습니다.',
    exchangeLabel: '거래소',
    fromLabel: '시작',
    toLabel: '끝',
    totalTrades: '총 거래 수',
    tradesWindowHint: '거래소 또는 기간으로 필터링하세요.',
    netPnL: '순 손익',
    realizedPnL: '실현 손익',
    winRate: '승률',
    breakEven: '본전',
    breakEvenHint: '손익 0 거래',
    tradeHistory: '거래 내역',
    recentTrades: '최근 거래',
    quantityLabel: '수량',
    byExchange: '거래소별',
    bySide: '매수/매도',
    bySymbol: '종목별',
    aiOpinions: 'AI 의견',
    outcomes: '결과 요약',
    similarSetups: '유사 셋업',
    outcomeTitle: '성과 추적',
    similarTitle: '유사 상황',
    settingsTitle: '설정',
    settingsSubtitle: '거래소, AI 키, 구독 정보를 관리합니다.',
    notFoundTitle: '요청한 페이지를 찾을 수 없습니다.',
    notFoundBody: '현재 작업 공간에 없는 경로입니다. 차트로 돌아가세요.',
    goToChart: '차트로 이동',
    bubbleModalTitle: '새 버블 기록',
    bubbleModalSubtitle: '순간의 판단을 기록하세요.',
    bubbleSideLabel: '매수/매도',
    bubbleSideNeutral: '중립',
    bubbleSideBuy: '매수',
    bubbleSideSell: '매도',
    candleTimeLabel: '캔들 시간',
    priceLabel: '가격',
    memoLabel: '메모',
    tagsLabel: '태그 (쉼표 구분)',
    cancel: '취소',
    saveBubble: '버블 저장',
    // Alerts & Notifications
    navAlerts: '알림',
    alertsTitle: '알림',
    alertsSubtitle: '트리거된 알림을 확인하고 판단을 기록합니다.',
    alertRulesTitle: '알림 규칙',
    alertRulesSubtitle: '알림 트리거 조건을 설정합니다.',
    alertDetailTitle: '알림 상세',
    noAlerts: '아직 알림이 없습니다.',
    noRules: '설정된 규칙이 없습니다.',
    createRule: '규칙 생성',
    editRule: '규칙 수정',
    deleteRule: '삭제',
    ruleName: '규칙 이름',
    ruleType: '규칙 유형',
    ruleSymbol: '심볼',
    ruleEnabled: '활성화',
    ruleCooldown: '쿨다운 (분)',
    ruleTypePrice: '가격 변동',
    ruleTypeMA: 'MA 교차',
    ruleTypeLevel: '가격 수준',
    ruleTypeVolatility: '변동성 급등',
    statusAll: '전체',
    statusPending: '대기',
    statusBriefed: '브리핑됨',
    statusDecided: '결정됨',
    statusExpired: '만료',
    severityNormal: '보통',
    severityUrgent: '긴급',
    aiBriefings: 'AI 브리핑',
    noBriefings: 'AI 브리핑이 아직 없습니다.',
    decisionTitle: '나의 판단',
    decisionAction: '행동',
    decisionMemo: '메모',
    decisionConfidence: '확신도',
    submitDecision: '판단 제출',
    dismissAlert: '무시',
    outcomeTitle: '성과',
    noOutcomes: '아직 성과 데이터가 계산되지 않았습니다.',
    confidenceHigh: '높음',
    confidenceMedium: '보통',
    confidenceLow: '낮음',
    actionBuy: '매수',
    actionSell: '매도',
    actionHold: '보유',
    actionClose: '청산',
    actionReduce: '축소',
    actionAdd: '추가',
    actionIgnore: '무시',
    telegramTitle: '텔레그램 알림',
    telegramConnect: '텔레그램 연결',
    telegramDisconnect: '연결 해제',
    telegramConnected: '연결됨',
    telegramNotConnected: '미연결',
    telegramCodeMsg: '텔레그램 봇에 이 코드를 전송하세요:',
    telegramOpenBot: '아래 버튼을 눌러 텔레그램으로 연결하세요:',
    telegramOpenBotBtn: '텔레그램에서 열기',
    telegramExpires: '만료까지',
    direction: '방향',
    threshold: '임계값',
    reference: '기준',
    maPeriod: 'MA 기간',
    maTimeframe: '타임프레임',
    targetPrice: '목표 가격',
    multiplier: '배수',
    timeAgo: '전',
    viewDetail: '상세',
    manageRules: '규칙 관리',
    save: '저장',
  },
}

export function useLocale() {
  const [locale, setLocale] = useState<Locale>('en')
  const [mounted, setMounted] = useState(false)

  useEffect(() => {
    setMounted(true)
    const savedLocale = localStorage.getItem('kifu-language')
    if (savedLocale === 'ko' || savedLocale === 'en') {
      setLocale(savedLocale)
    } else if (navigator.language.toLowerCase().startsWith('ko')) {
      setLocale('ko')
    }
  }, [])

  // Return default locale during SSR and initial hydration
  // Only return detected locale after component is mounted
  return mounted ? locale : 'en'
}

export function useI18n() {
  const locale = useLocale()
  return useMemo(() => {
    const t = dictionary[locale]
    return { t, locale }
  }, [locale])
}
